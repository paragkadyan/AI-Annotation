# Auto-Detection Extension Workflow (Updated)

## Overview

The VS Code extension now automatically detects all metadata from:
1. **EMPID** - Read from `.env` file
2. **Tool Name** - Read from VS Code settings (defaults to "GitHub Copilot")
3. **Tool Version** - Read from VS Code settings (optional)
4. **Timestamp** - Automatically generated as ISO 8601

## What This Means

You no longer need to manually enter:
- ❌ Employee ID / EMPID
- ❌ Tool Version (unless you change it)

You only confirm:
- ✅ "Was this code generated using AI?" (for pasted code)
- ✅ Final confirmation before wrapping

---

## Setup (One-Time)

### 1. Create .env File

Create a `.env` file in your project/workspace root:

```
EMPID=1223
```

Or copy from template:
```bash
cp .env.example .env
# Edit and set EMPID=1223
```

### 2. Configure VS Code Settings

Add to VS Code settings.json:

```json
{
  "ai-annotator.defaultTool": "GitHub Copilot",
  "ai-annotator.defaultToolVersion": "1.0.5"
}
```

**VS Code Settings Location**:
- File → Preferences → Settings
- Or search for `ai-annotator`

---

## New Workflow

### Keyboard Shortcut (Ctrl+Shift+A)

**Before** (Old):
1. Select code
2. Press Ctrl+Shift+A
3. Enter tool name (dialog 1)
4. Enter version (dialog 2)
5. Enter empid (dialog 3)
6. Confirm (dialog 4)
7. Code wrapped ✅

**Now** (New - Auto-Detection):
1. Select code
2. Press Ctrl+Shift+A
3. Confirm: "Use GitHub Copilot (emp-1223)?" (dialog 1)
4. Code wrapped ✅

**Result**: 3/4 dialogs eliminated, fully automated!

### Auto-Detection on Paste

**Before** (Old):
1. Paste code → dialog asks "AI-generated?"
2. Yes → dialog asks for tool
3. Dialog asks for version
4. Dialog asks for empid
5. Confirm dialog
6. Code wrapped

**Now** (New - Auto-Detection):
1. Paste code → dialog asks "AI-generated?"
2. Yes → Confirm dialog with auto-values
3. Code wrapped ✅

---

## Data Flow

```
Keyboard Press (Ctrl+Shift+A)
    ↓
Read .env → EMPID = 1223
    ↓
Read Settings → Tool = GitHub Copilot, Version = 1.0.5
    ↓
Generate ISO timestamp
    ↓
Show confirmation: "Use GitHub Copilot (emp-1223)?"
    ↓
User confirms
    ↓
Wrap code with all metadata auto-populated
```

---

## Example Annotated Code

When you use the extension with auto-detection:

```python
# START_AI_GENERATED_CODE
# TOOL_NAME: GitHub Copilot
# TOOL_VERSION: 1.0.5
# DATE: 2025-02-15T14:30:00.123Z
# AUTHOR_ID: 1223
# ACTION: GENERATED
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)
# END_AI_GENERATED_CODE
```

**What's Automatic**:
- ✅ TOOL_NAME = GitHub Copilot (from VS Code settings)
- ✅ TOOL_VERSION = 1.0.5 (from VS Code settings)
- ✅ DATE = 2025-02-15T14:30:00.123Z (generated now)
- ✅ AUTHOR_ID = 1223 (from .env EMPID)
- ✅ ACTION = GENERATED (always)

**What You Confirm**:
- ✅ Use these values? Yes/No

---

## Configuration Precedence

If a setting is not found, fallback order is:

1. **EMPID** (.env file):
   ```
   EMPID=12345
   ```

2. **Tool Name** (VS Code Settings):
   ```json
   "ai-annotator.defaultTool": "GitHub Copilot"
   ```
   Fallback: "GitHub Copilot"

3. **Tool Version** (VS Code Settings):
   ```json
   "ai-annotator.defaultToolVersion": "1.0.5"
   ```
   Fallback: (omitted if not set)

4. **Date**: Always auto-generated using `new Date().toISOString()`

---

## .env File Format

```bash
# Comments start with #

# Required - Employee ID
EMPID=1223

# Optional - can also be set in VS Code settings
# Tool name (case-sensitive)
# TOOL_NAME=GitHub Copilot

# Optional - tool version
# TOOL_VERSION=1.0.5
```

### Important Notes

- Put `.env` in your workspace/project root
- Add `.env` to `.gitignore` if it contains sensitive info
- Use `.env.example` as template for team sharing

---

## Extension Error Messages

**If EMPID not found**:
```
EMPID not found in .env file.
Please add EMPID=<your-id> to your .env file.
```

**Solution**:
```bash
# Create .env with EMPID
echo "EMPID=1223" > .env
```

**If no editor open**:
```
No active editor. Please open a file first.
```

**If no code selected**:
```
No code selected. Please select code to annotate.
```

---

## Testing the Auto-Detection

1. **Create .env file**:
```bash
echo "EMPID=1223" > .env
```

2. **Open VS Code settings** and add:
```json
{
  "ai-annotator.defaultTool": "GitHub Copilot",
  "ai-annotator.defaultToolVersion": "1.0.5"
}
```

3. **Open a Python file** and add:
```python
def hello():
    return "world"
```

4. **Select the code** (Ctrl+A)

5. **Press Ctrl+Shift+A** (Windows/Linux) or Cmd+Shift+A (Mac)

6. **Expected**:
   - Dialog: "Annotate as generated by GitHub Copilot (1223)?"
   - Click: Yes
   - Code wrapped with auto-detected metadata

---

## Comparison: Old vs New

| Aspect | Old Workflow | New Workflow |
|--------|--------------|--------------|
| Dialogs per annotation | 4 | 1 |
| Manual inputs | 3 (tool, version, id) | 0 |
| Configuration | Settings only | .env + Settings |
| Time per annotation | ~30 seconds | ~5 seconds |
| Error-prone | Yes | No |
| Consistency | Manual | Automatic |

---

## FAQ

**Q: What if I don't have .env file?**

A: Extension shows error message. Create .env with:
```
EMPID=1223
```

**Q: Can I change tool/version each time?**

A: Not in new workflow - it's auto-detected from settings. To change:
1. Update VS Code settings
2. Or edit the settings.json: Add `"ai-annotator.defaultTool": "GPT-4"`

**Q: Is EMPID from .env secure?**

A: Yes! .env is typically not committed to git (add to .gitignore). Each developer has their own EMPID locally.

**Q: What if team members have different EMPIDs?**

A: Each person creates their own .env file:
```bash
# Developer A creates .env with their EMPID
echo "EMPID=1223" > .env

# Developer B creates .env with their EMPID
echo "EMPID=5678" > .env
```

---

## Summary

The extension now works **automatically**:

1. ✅ Reads EMPID from `.env` file
2. ✅ Reads Tool name from VS Code settings
3. ✅ Generates timestamp automatically
4. ✅ Shows one-click confirmation
5. ✅ Wraps code instantly

**Faster, simpler, fewer errors.**

---

Created: 2025-02-15
Updated for auto-detection workflow
